/*!
 * @fl/svg2canvas v0.0.1
 * (c) 2021-2021 FatDragon-Chan
 * Released under the MIT License.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).svg2canvas={})}(this,(function(t){"use strict";function e(t){return t.split("-")}const s={};function r(){return Array(3).fill(0).map((()=>Math.ceil(255*Math.random()))).concat(255).join("-")}class i{constructor(){this.id=function(){let t=r();for(;s[t];)t=r();return t}(),this.listeners={}}draw(t){throw new Error("Method not implemented.")}clone(t){throw new Error("Method not implemented.")}on(t,e){this.listeners[t]?this.listeners[t].push(e):this.listeners[t]=[e]}getListeners(){return this.listeners}getId(){return this.id}}var a=function(t){var e=[];return t.replace(n,(function(t,s,r){var i=s.toLowerCase();for(r=function(t){var e=t.match(h);return e?e.map(Number):[]}(r),"m"==i&&r.length>2&&(e.push([s].concat(r.splice(0,2))),i="l",s="m"==s?"l":"L");;){if(r.length==o[i])return r.unshift(s),e.push(r);if(r.length<o[i])throw new Error("malformed path data");e.push([s].concat(r.splice(0,o[i])))}})),e},o={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},n=/([astvzqmhlc])([^astvzqmhlc]*)/gi;var h=/-?[0-9]*\.?[0-9]+(?:e[-+]?\d+)?/gi;var l=function(t){var e=0,s=0,r=0,i=0;return t.map((function(t){var a=(t=t.slice())[0],o=a.toUpperCase();if(a!=o)switch(t[0]=o,a){case"a":t[6]+=r,t[7]+=i;break;case"v":t[1]+=i;break;case"h":t[1]+=r;break;default:for(var n=1;n<t.length;)t[n++]+=r,t[n++]+=i}switch(o){case"Z":r=e,i=s;break;case"H":r=t[1];break;case"V":i=t[1];break;case"M":r=e=t[1],i=s=t[2];break;default:r=t[t.length-2],i=t[t.length-1]}return t}))};var c,p,u=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var s=[],r=!0,i=!1,a=void 0;try{for(var o,n=t[Symbol.iterator]();!(r=(o=n.next()).done)&&(s.push(o.value),!e||s.length!==e);r=!0);}catch(t){i=!0,a=t}finally{try{!r&&n.return&&n.return()}finally{if(i)throw a}}return s}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")},d=2*Math.PI,f=function(t,e,s,r,i,a,o){var n=t.x,h=t.y;return{x:r*(n*=e)-i*(h*=s)+a,y:i*n+r*h+o}},v=function(t,e){var s=1.5707963267948966===e?.551915024494:-1.5707963267948966===e?-.551915024494:4/3*Math.tan(e/4),r=Math.cos(t),i=Math.sin(t),a=Math.cos(t+e),o=Math.sin(t+e);return[{x:r-i*s,y:i+r*s},{x:a+o*s,y:o-a*s},{x:a,y:o}]},g=function(t,e,s,r){var i=t*s+e*r;return i>1&&(i=1),i<-1&&(i=-1),(t*r-e*s<0?-1:1)*Math.acos(i)},m=function(t){var e=t.px,s=t.py,r=t.cx,i=t.cy,a=t.rx,o=t.ry,n=t.xAxisRotation,h=void 0===n?0:n,l=t.largeArcFlag,c=void 0===l?0:l,p=t.sweepFlag,m=void 0===p?0:p,w=[];if(0===a||0===o)return[];var y=Math.sin(h*d/360),M=Math.cos(h*d/360),x=M*(e-r)/2+y*(s-i)/2,b=-y*(e-r)/2+M*(s-i)/2;if(0===x&&0===b)return[];a=Math.abs(a),o=Math.abs(o);var C=Math.pow(x,2)/Math.pow(a,2)+Math.pow(b,2)/Math.pow(o,2);C>1&&(a*=Math.sqrt(C),o*=Math.sqrt(C));var k=function(t,e,s,r,i,a,o,n,h,l,c,p){var u=Math.pow(i,2),f=Math.pow(a,2),v=Math.pow(c,2),m=Math.pow(p,2),w=u*f-u*m-f*v;w<0&&(w=0),w/=u*m+f*v;var y=(w=Math.sqrt(w)*(o===n?-1:1))*i/a*p,M=w*-a/i*c,x=l*y-h*M+(t+s)/2,b=h*y+l*M+(e+r)/2,C=(c-y)/i,k=(p-M)/a,E=(-c-y)/i,S=(-p-M)/a,A=g(1,0,C,k),I=g(C,k,E,S);return 0===n&&I>0&&(I-=d),1===n&&I<0&&(I+=d),[x,b,A,I]}(e,s,r,i,a,o,c,m,y,M,x,b),E=u(k,4),S=E[0],A=E[1],I=E[2],N=E[3],j=Math.abs(N)/(d/4);Math.abs(1-j)<1e-7&&(j=1);var O=Math.max(Math.ceil(j),1);N/=O;for(var T=0;T<O;T++)w.push(v(I,N)),I+=N;return w.map((function(t){var e=f(t[0],a,o,M,y,S,A),s=e.x,r=e.y,i=f(t[1],a,o,M,y,S,A),n=i.x,h=i.y,l=f(t[2],a,o,M,y,S,A);return{x1:s,y1:r,x2:n,y2:h,x:l.x,y:l.y}}))};function w(t,e,s,r){return["C",t,e,s,r,s,r]}function y(t,e,s,r,i,a){return["C",t/3+2/3*s,e/3+2/3*r,i/3+2/3*s,a/3+2/3*r,i,a]}class M extends i{constructor(t){super(),this.props=t,this.props.fillColor=this.props.fillColor||"#fff"}draw(t){const{fillColor:e,d:s,translate:r=["0","0"]}=this.props;if(!("string"==typeof(i=s)&&(i=i.trim(),/^[mzlhvcsqta]\s*[-+.0-9][^mlhvzcsqta]+/i.test(i)&&/[\dz]$/i.test(i)&&i.length>4)))throw new Error("Not an SVG path!");var i;const o=function(t){for(var e,s=[],r=0,i=0,a=0,o=0,n=null,h=null,l=0,c=0,p=0,u=t.length;p<u;p++){var d=t[p],f=d[0];switch(f){case"M":a=d[1],o=d[2];break;case"A":var v=m({px:l,py:c,cx:d[6],cy:d[7],rx:d[1],ry:d[2],xAxisRotation:d[3],largeArcFlag:d[4],sweepFlag:d[5]});if(!v.length)continue;for(var g,M=0;M<v.length;M++)d=["C",(g=v[M]).x1,g.y1,g.x2,g.y2,g.x,g.y],M<v.length-1&&s.push(d);break;case"S":var x=l,b=c;"C"!=e&&"S"!=e||(x+=x-r,b+=b-i),d=["C",x,b,d[1],d[2],d[3],d[4]];break;case"T":"Q"==e||"T"==e?(n=2*l-n,h=2*c-h):(n=l,h=c),d=y(l,c,n,h,d[1],d[2]);break;case"Q":n=d[1],h=d[2],d=y(l,c,d[1],d[2],d[3],d[4]);break;case"L":d=w(l,c,d[1],d[2]);break;case"H":d=w(l,c,d[1],c);break;case"V":d=w(l,c,l,d[1]);break;case"Z":d=w(l,c,a,o)}e=f,l=d[d.length-2],c=d[d.length-1],d.length>4?(r=d[d.length-4],i=d[d.length-3]):(r=l,i=c),s.push(d)}return s}(l(a(s)));t.save(),t.beginPath(),t.scale(.5,.5),t.translate(r[0],r[1]),o.length&&(o.forEach((e=>{const[s,...r]=e;"M"===s?t.moveTo(...r):t.bezierCurveTo(...r)})),t.closePath(),t.fillStyle=e,t.fill(),t.restore())}clone(){const[t,s,r,i]=e(this.id);return new M(Object.assign(Object.assign({},this.props),{fillColor:`rgba(${t}, ${s}, ${r}, ${i})`}))}}class x extends i{constructor(t){super(),this.props=t,this.props.fillColor=this.props.fillColor||"#fff",this.props.strokeColor=this.props.strokeColor||"#000",this.props.strokeWidth=this.props.strokeWidth||1}draw(t){const{x:e,y:s,radius:r,fillColor:i,translate:a}=this.props;t.save(),t.beginPath(),t.scale(.5,.5),t.translate(a[0],a[1]),t.fillStyle=i,t.arc(e,s,r,0,2*Math.PI),t.fill(),t.restore()}clone(){const[t,s,r,i]=e(this.id);return new x(Object.assign(Object.assign({},this.props),{fillColor:`rgba(${t}, ${s}, ${r}, ${i})`}))}}t.EventNames=void 0,(c=t.EventNames||(t.EventNames={})).click="click",c.mousedown="mousedown",c.mousemove="mousemove",c.mouseup="mouseup",c.mouseenter="mouseenter",c.mouseleave="mouseleave",function(t){t.Down="DOWN",t.Up="Up",t.Move="MOVE"}(p||(p={}));class b{constructor(){this.listenersMap={}}addAction(e,s){const{type:r,id:i}=e;r===p.Move&&this.fire(i,t.EventNames.mousemove,s),r!==p.Move||this.lastMoveId&&this.lastMoveId===i||(this.fire(i,t.EventNames.mouseenter,s),this.fire(this.lastMoveId,t.EventNames.mouseleave,s)),r===p.Down&&this.fire(i,t.EventNames.mousedown,s),r===p.Up&&this.fire(i,t.EventNames.mouseup,s),r===p.Up&&this.lastDownId===i&&this.fire(i,t.EventNames.click,s),r===p.Move?this.lastMoveId=e.id:r===p.Down&&(this.lastDownId=e.id)}addListeners(t,e){this.listenersMap[t]=e}fire(t,e,s){this.listenersMap[t]&&this.listenersMap[t][e]&&this.listenersMap[t][e].forEach((t=>t(s)))}}t.Circle=x,t.Path=M,t.Polygon=class extends i{constructor(t){super(),this.props=t,this.props.fillColor=this.props.fillColor||"#fff",this.props.strokeColor=this.props.strokeColor||"#000",this.props.strokeWidth=this.props.strokeWidth||1}draw(t){const{fillColor:e,translate:s,points:r}=this.props,i=r.split(" ").filter((t=>""!==t)),a=[],o=[];i.forEach(((t,e)=>{e%2==0?a.push(t):o.push(t)})),t.save(),t.beginPath(),t.scale(.5,.5),t.translate(s[0],s[1]),a.forEach(((e,s)=>{s<=0?t.moveTo(e,o[s]):t.lineTo(e,o[s])})),t.fillStyle=e,t.fill(),t.restore()}},t.Stage=class{constructor(t,e,s){const{width:r,height:i}=t;this.width=r,this.height=i,this.canvas=t.node,this.osCanvas=e.node,this.children=[],this.ctx=this.canvas.getContext("2d"),this.osCtx=this.osCanvas.getContext("2d"),this.dpr=s,this.canvas.width=r*this.dpr,this.canvas.height=i*this.dpr,this.ctx.scale(this.dpr,this.dpr),this.osCanvas.width=r*this.dpr,this.osCanvas.height=i*this.dpr,this.osCtx.scale(this.dpr,this.dpr),this.shapes=new Set,this.eventSimulator=new b}add(t){if(Object.keys(t.getListeners()).length>0){const e=t.getId();this.eventSimulator.addListeners(e,t.getListeners()),this.shapes.add(e)}this.children.push(t)}render(){this.children.forEach((t=>{t.draw(this.ctx),Object.keys(t.getListeners()).length>0&&t.clone().draw(this.osCtx)}))}clear(){this.children=[],this.shapes.clear(),this.ctx.clearRect(0,0,this.width,this.height)}touchStartHandler(t){const e=t.touches[0],{x:s,y:r}=e,i=this.hitJudge(s,r);this.eventSimulator.addAction({type:p.Down,id:i},t)}touchEndHandler(t){const e=t.changedTouches[0],{x:s,y:r}=e,i=this.hitJudge(s,r);this.eventSimulator.addAction({type:p.Up,id:i},t)}hitJudge(t,e){const s=function(t){return t.join("-")}(Array.from(this.osCtx.getImageData(t*this.dpr,e*this.dpr,1,1).data));return this.shapes.has(s)?s:void 0}},Object.defineProperty(t,"__esModule",{value:!0})}));
